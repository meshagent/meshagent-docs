---
title: "Use an Existing Agent"
---

import PydanticAgents from "/snippets/examples/python/agents/taskrunner/pydanticai_translator/pydanticai_translator_taskrunner.mdx"
import InvokingTaskRunner from "/snippets/examples/python/agents/taskrunner/pydanticai_translator/invoking_taskrunner.mdx"

This example shows how to wrap an existing Pydantic AI translation agent with a MeshAgent [``TaskRunner``](./taskrunner). We subclass the base ``TaskRunner`` to create a ``TranslationTaskRunner`` with a defined input schema, output schema, and ``ask()`` method. This allows us to keep the existing logic from the Pydantic AI agent and run it inside a MeshAgent room.

### Prerequisites
- Python venv with ``meshagent`` and ``pydantic_ai`` installed
- An LLM provider key (example uses ``ANTHROPIC_API_KEY``)
- Authenticate to MeshAgent ``meshagent setup``

## Example: Integrating a Pydantic AI Agent
Copy this code into a file called ``translator.py``. You will need to create and export an ``ANTHROPIC_API_KEY`` first for this to run. Or update the example to use a model from a different provider of your choice. 

<CodeGroup>
    <PydanticAgents />
</CodeGroup>

### Running the TaskRunner

From the terminal start your service locally. Be sure you are in an activated virtual environment where meshagent and pydantic_ai are installed: 

```bash bash
meshagent setup # this will authenticate you 
meshagent service run "translator.py" --room=translate
```

#### Invoking from the Studio
1. Go to [MeshAgent Studio](https://studio.meshagent.com) 
2. Enter the room ``translate``
3. Click the upper left menu --> "Run Task"
4. Select **translator** from the agent dropdown 
5. Enter the text to translate
6. Results appear and are saved to room storage under the "translations" folder 

#### Invoking from the CLI or Code
**From the CLI** 
While the service is running, create a new tab in your terminal and run: 
```bash CLI
meshagent room agents ask \
  --room=translate \
  --agent=translator \
  --input='{"text":"I love MeshAgent!"}'
```

This will return a result like: 
```
Connecting to room...
Asking agent...
{"french_translation": "J'adore MeshAgent !", "spanish_translation": "\u00a1Me encanta MeshAgent!"}
```

**From Code** 

Create and run a file called ``invoke_translator.py``. This will establish the connection to the room and allow you to run the TranslationTaskRunner. 

<CodeGroup>
    <InvokingTaskRunner />
</CodeGroup>

Be sure your service is still running locally, then from a separate tab in your terminal run:
```bash bash
# Create, Activate, and export your MESHAGENT_API_KEY if you haven't already
# meshagent api-key create my-api-key activate
# export MESHAGENT_API_KEY="xxxxxxx"
python invoke_translator.py
```

You will see the result logged to your terminal and saved in the room. 

## Next Steps
- [TaskRunner Overview](./taskrunner): Understand TaskRunners and how to use them
- [Services & Containers](../../services_room_containers/overview): Understand different options for running, deploying, and managing agents with MeshAgent
- [Secrets & Registries](../../secrets/secrets_overview): Learn how to store credentials securely for deployment

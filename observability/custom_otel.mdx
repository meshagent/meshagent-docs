---
title: "Custom Logs, Traces, and Metrics"
---

import OtelExample from "/snippets/examples/python/deployable/observability/observability.mdx"
import OtelYAML from "/snippets/examples/python/deployable/observability/meshagent.mdx"

MeshAgent emits OpenTelemetry signals out of the box. When you need deeper insight, you can add your own spans, logs, and metrics using standard OTEL SDKs. This guide walks through a Weather Toolkit with custom intstrumentation so you can see the pieces in action. 

## Enable telemetry in your service
Add two lines at startup before you create your ``ServiceHost``: 

```python Python
from meshagent.otel import otel_config
otel_config(service_name="weather-service")
```

This initializes tracing, logging, and metrics and tags everything with your project/room/session so it shows up live in MeshAgent Studio.

## Example: Weather Toolkit with custom instrumentation
The example adds custom spans around validation, the external HTTP call, and response parsing. It also adds logs and metrics.

<CodeGroup>
    <OtelExample />
</CodeGroup>

### Custom Spans
Use spans to track a specific operation in trace. Spans can help you understand timing for each step and attach attributes/events to make debugging easier.

This example records: 
- ``toolkit.execute`` (created by MeshAgent) this is the high-level tool call including information about which tool was called and what information was passed to the tool
    - `validate_input` – checks city/units, adds events for pass/fail
    - `fetch_weather_api` – the external HTTP call with:
        - `http.url`, `http.method`, `http.status_code`, `http.response_size`
        - events like `api_request_start`, `api_request_success`, `api_timeout`, `rate_limit_exceeded`
    - `parse_response` – extracts the fields you return to the caller

Capturing additional information inside the (span/trace) created by MeshAgent allows us to capture finer-grained information about our process. 

**Pattern:**
```python Python
from opentelemetry import trace
from opentelemetry.trace import Status, StatusCode

tracer = trace.get_tracer(__name__)
with tracer.start_as_current_span("fetch_weather_api") as span:
    span.set_attribute("http.url", api_url)
    span.add_event("api_request_start")
    ...
    if resp.status_code == 429:
        span.set_status(Status(StatusCode.ERROR, "Rate limited"))
```
These show up in the room’s **Traces** tab.

### Custom Logs
``otel_config()`` sets up an OTEL logging handler so your normal logging.info() lines are captured. Add extra logs to make it easier to debug and understand...

```python Python
import logging
log = logging.getLogger(__name__)

log.info(f"Weather tool is running for city: {city} with units: {units}")
```

These show up in the room’s **Logs** tab.

### Custom Metrics
You can also add additional counters and historgrams to help track trends over time.

```python Python
from opentelemetry import metrics
meter = metrics.get_meter("weather.tools")

calls = meter.create_counter("weather.calls", unit="1",
                             description="Total weather tool invocations")

# When a call starts
calls.add(1, attributes={"city": city.lower(), "units": units})
```

These show up in the room’s **Metrics** tab.

## Running the sample
You can run this toolkit as a service and invoke the weather tool, `get_weather()`, from Studio or the CLI.

### Step 1: Creating the room service 
To deploy the otel service you'll need to:
1. Create a Dockerfile, build/push the container (or use the available meshagent image) 
2. Create a yaml file that defines the service
3. Deploy it using the MeshAgent CLI. 

**(Optional) Create your container** If you want to create your own image you'll need to create a Dockerfile and build and push a container. 

```Dockerfile Dockerfile
FROM "meshagent/python-sdk-slim:latest"

WORKDIR /src
RUN python3 -m pip install --no-cache-dir httpx
COPY . /src

ENTRYPOINT [ "python3", "main.py" ] 
```

```bash 
docker buildx build . \
  -t "$IMAGE:$TAG" \ # fill this in 
  --platform linux/amd64 \
  --push
```

**Create a `meshagent.yaml` file that defines the service**

If you built and pushed your own container you can update the container path in the YAML file below. Otherwise you can use the meshagent container. 

<CodeGroup>
    <OtelYAML />
</CodeGroup>

**Deploy the service**

```bash bash
meshagent service create --file=meshagent.yaml --room=otel
```

### Step 2: Invoking the tool 
Once you've created the service you can invoke the tool directly from MeshAgent Studio by going into the room, clicking the menu icon, selecting **Toolkits**, then select the **Weather Tool** and click **Invoke**. The UI will display a dialog for you to input the city and units you want to get the weather from. 

You can also invoke the tool using the MeshAgent CLI:

```bash bash 
meshagent room agents invoke-tool \
  --room=otel \
  --toolkit=weather-toolkit \
  --tool=get_weather \
  --arguments='{"city":"Costa Mesa","units":"imperial"}'
```

## Viewing telemetry 
From [MeshAgent Studio](https://studio.meshagent.com) you will see Logs, Traces, and Metrics both from the **Session** view of the room and from the **Developer Console**. The **Session** viewer provides a focused view of session details which are accessible during and after each session. The **Developer Console** appears on the lower part of the screen once you're inside a room and shows live traces, logs, and metrics as you interact with your services inside a room.

After invoking the weather tool in this example you should see a trace tree appear in the **Traces** tab with a structure like this: 

```
toolkit.execute (get_weather)
 ├─ validate_input
 ├─ fetch_weather_api
 └─ parse_response
```

Applicable logs and metrics will appear under their respective tabs. 

## Next Steps
- [Agents](../agents/standard/intro): Understand how agents work in MeshAgent and start building your first one!
- [Tools](../agents/tools/intro): Learn how to build tools human and agent participants can use inside a MeshAgent room. 
- [Services & Containers](../services_room_containers/overview): Learn how to deploy instrumented agents and tools as project wide or room specific services in MeshAgent

---
title: "Custom Traces, Logs, and Metrics"
---

MeshAgent emits OpenTelemetry signals by default, but you can layer in your own spans, logs, and metrics using the standard OTEL SDKs. This guide extends a ChatBot with custom instrumentation so you can see how the pieces fit together.

> **Prerequisites:** Call `meshagent.otel.otel_config()` at startup and point `OTEL_ENDPOINT` at an OTLP/HTTP collector (for local testing you can run `otel/opentelemetry-collector:latest` or reuse the collector URL from your MeshAgent deployment).

## Example: Instrumented ChatBot

The sample `meshagent-sdk/meshagent-docs/examples/python/observability/custom_telemetry.py` registers an `InstrumentedChatbot` that adds:

- A span around context preparation with user message previews.
- Structured logs before the LLM call and before the response is sent.
- Counter and histogram metrics for response throughput and context latency.

Run the service in a project where the ChatBot can reach your collector:

```bash
export OTEL_ENDPOINT="http://localhost:4318"
python meshagent-sdk/meshagent-docs/examples/python/observability/custom_telemetry.py
```

Open the bot in MeshAgent Studio (or any client) and chat—it will emit custom telemetry alongside the platform defaults.

## Key Instrumentation Points

### Custom Spans

```python
with tracer.start_as_current_span("chatbot.prepare_context") as span:
    message_count = len(thread_context.chat.messages)
    span.set_attribute("meshagent.chat.messages", message_count)
    span.set_attribute("meshagent.thread.path", thread_context.path)
    if last_user_message:
        span.add_event("user_message.preview", {"preview": last_user_message[:120]})
```

`prepare_llm_context` runs before the LLM request, so the span captures how much chat history will be sent and a short preview of the user input. The span name, attributes, and events show up in any trace explorer that ingests OTLP data.

### Structured Logs

```python
logger.info(
    "sending response",
    extra={"path": path, "response_id": id, "characters": len(text)},
)
```

`otel_config` installs an OTEL logging handler, so ordinary Python logs flow into your collector with the attached key/value pairs. Use this pattern for breadcrumbs you want to correlate with spans.

### Metrics

```python
response_counter.add(
    1,
    attributes={
        "meshagent.thread.path": path,
        "meshagent.recipient.id": to.id,
    },
)

context_histogram.record(
    elapsed_ms,
    attributes={"meshagent.thread.path": thread_context.path},
)
```

`chatbot.responses` counts every assistant message, while `chatbot.context.prepare_ms` captures how long the context builder ran. Both are exported over OTLP along with the built-in MeshAgent metrics.

## Viewing the Results

- In MeshAgent Studio, enable the developer console to watch the new spans and logs stream in as you chat.
- In your collector or APM (Grafana, Honeycomb, New Relic, etc.), filter by span name `chatbot.prepare_context` or the `chatbot.` metric namespace to build dashboards and alerts.

Feel free to borrow the same pattern for your own agents and tools—MeshAgent handles the exporters so you can focus on capturing the business signals that matter.

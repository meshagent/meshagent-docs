---
title: Example Running a Chatbot with the Containers API
---

Services that require or allow users to pass values to the service should be run as room services via the Containers API. For example, if we want to allow users to set the own system prompt on an agent, or bring their own API key, we need to run the agent as a room service not a project service. This is because project services are the same across all the rooms in the project, while room services via the containers API are dynamic and can be tailored to each room. 

To learn more about project vs room level services and understand when to use each see [intro to services and containers](../overview).

## Example

Let's create a simple chatbot that allows users to give it a system prompt when deploying. To deploy this we'll need the main.py file, a Dockerfile, and a meshagent.yaml file.

### main.py

```python Python
import os
import asyncio
import logging
from meshagent.agents.chat import ChatBot
from meshagent.api.services import ServiceHost
from meshagent.openai import OpenAIResponsesAdapter

logging.basicConfig(level=logging.DEBUG)

system_prompt = os.getenv("SYSTEM_PROMPT")
rules = [system_prompt] if system_prompt else []

host = ServiceHost()

@host.path("/agent")
class MyChatBot(ChatBot): 
    def __init__(self):
        super().__init__(
            name="chatbot",
            rules=rules,
            llm_adapter=OpenAIResponsesAdapter(),
        )

asyncio.run(host.run())
```

### Dockerfile

```Dockerfile Dockerfile
FROM meshagent/python-sdk-slim:latest

COPY . /src

WORKDIR /src

ENTRYPOINT [ "python3", "main.py" ]
```

### meshagent.yaml
```yaml yaml
kind: ServiceTemplate
version: v1
metadata:
  name: chatbot
  description: "chatbot that takes a system prompt"

variables:
- name: "system_prompt"

environment:
- name: SYSTEM_PROMPT
  value: "{system_prompt}"
- name: tone
  enum: ["formal", "casual", "enthusiastic"]
  optional: true
ports:
- num: "*"
  liveness: "/"
  endpoints:
  - path: /agent
    identity: chatbot
    type: meshagent.callable
```

## Build and Run the Container
Now that we've defined our agent and written the applicable Dockerfile and meshagent.yaml we can build and push the docker container. 

You can build and run the container in a MeshAgent room directly using the MeshAgent CLI commands. You can also build and push to a docker repo you have access to then pull and run the image. 

**Using the MeshAgent CLI**
From the directory with your code, Dockerfile, and meshagent.yaml run: 

```bash 
meshagent setup # authenticate to MeshAgent if not already connected
meshagent container build context --room=myroom --tag=chatbot:0.1 --from_dir= . 
meshagent container run --room=myroom --image=chatbot:0.1 --var system_prompt="Always respond with a fun fact"
```

*For other build options you can use ``meshagent container build --help``.*

**To test the agent**: 
1. Go to [MeshAgent Studio](https://studio.meshagent.com)
2. Select the **Sessions** tab then open ``myroom``
3. You'll see the chatbot in the participants tab. 
 
**Troubleshooting**: 
Inside your room in the studio look at the **Developer Console** on the bottom of the screen. Here you'll see images in the room, containers running, and builds. From the images tab you should see the image you built "chatbot:0.1", this should be green. If it is not green that means the image did not build properly and could indicate that you are missing the meshagent.yaml file. From the containers tab you should see the image running and who started it, you can also click into the container logs from this view. 


## Next Steps
Containers run on demand, and will not automatically restart the next time you go into the room. If you want a container with your configuration to save and start automatically the next time the room starts, you will need to deploy a project wide service to manage the containers. Otherwise you can start containers as needed through the CLI/API. 

For more information on room and project services see: 
- [Intro to Services & Containers](../overview): Understand when to use a project service and when to use the room services
- [Secrets & Registry Access]: Learn how to create and use MeshAgent secrets 

To learn how to create a project-wide service see: 
- [Project Service Configuration](../project_services/configuration): Create a ``Service`` meshagent.yaml for a project-wide service
- [Project Service Deployment](../project_services/deployment): Learn how to deploy project-wide services via the MeshAgent Studio or CLI
- [Project Service Example](../project_services/project_service_example): Create and deploy a chatbot as a project service
---
title: "Supabase MCP"
---

import MCPSupabaseYAML from "/snippets/examples/packaging/mcp_supabase.mdx"

Supabase is an open-source backend platform that provides a hosted Postgres database, auth, storage, and realtime APIs. The Supabase MCP server exposes these capabilities as tools that can be used in MeshAgent.

In this guide you'll learn how to:
- Create a Supabase account and access token
- Connect and test the Supabase MCP server locally with the MeshAgent CLI
- Deploy the Supabase MCP server as a MeshAgent service so that multiple participants in your room can share a single toolkit. 

> **Note**: Each MCP connection is scoped to a single Supabase project. If you need to connect multiple projects, repeat these steps with a different project reference and toolkit name.

## Prerequisites
- The MeshAgent CLI installed () and connected to the MeshAgent project you want to work in (run `meshagent setup` then select your project).
- Room admin access to the room you plan to use. (How to check this? Or do it in the studio?)
- A participant token with `api.secrets` and `api.admin` grants (this is granted by...)

## Step 1: Create a Supabase account and access token 
Create a Supabase account and a project at https://supabase.com. From the Project Settings -> General page you will see the Project ID/Project Reference. Copy this ID so you can connect to it through MCP. 

Next, create a Supabase access token from your account page under [Account Settings -> Access Tokens](https://supabase.com/dashboard/account/tokens). Generate a new token and set an expiration date for it. Keep this value private.

## Step 2: Test the MCP Server locally with the MeshAgent CLI
Make sure you have your project ref, access token, and a configured MeshAgent CLI.

1. Export the Supabase project ref and access token.

```bash
export SUPABASE_PROJECT_REF="your_project_ref"
export SUPABASE_ACCESS_TOKEN="your_access_token"
```

2. Create a room scoped secret to store the Supabase access token.
This requires you to be authenticated to MeshAgent with a token that has both `api.secrets` and `api.admin` grants because you are setting a secret for another identity. You must also be a room admin.

```bash 
meshagent setup # authenticate to MeshAgent if not already signed in

meshagent room secrets set \
  --room myroom \
  --secret-id supabase \
  --name supabase \
  --for-identity supabase \
  --text "$SUPABASE_ACCESS_TOKEN"
```

This creates a room secret that `--header-secret` can resolve. 

Why this matters: `--header-secret` resolves secrets from the room at runtime by **secret id/name** (it does not use template variables). We store it under the `supabase` identity so the service can read it when it connects with `MESHAGENT_TOKEN`.

3. Start an MCP session and register the Supabase toolkit in your room. This command initializes the MCP session and exposes it to the room.

```bash
meshagent mcp http \
  --room myroom \
  --toolkit-name supabase \
  --url "https://mcp.supabase.com/mcp?project_ref=$SUPABASE_PROJECT_REF" \
  --header-secret "Authorization:Bearer {supabase}" 
```

This will create a toolkit for the MCP Server and call it into the room so you can test it locally. If you open a new tab in your terminal and run `meshagent setup` then `meshagent room agents list-toolkits --room myroom` you will see the toolkit is connected to the room and all the available tools. 

You can also see the toolkit and invoke individual tools from [MeshAgent Studio](https://studio.meshagent.com). Go to `myroom`, then from the menu tab in the upper left select toolkits, you will see the `supabase` toolkit and it's associated tools. 

Now, let's test call an agent into the room and give it access to the supabase toolkit, we can update the rules on the agent so it better understands how to use the tools. 

4. In another terminal tab, start an agent that requires the Supabase toolkit.

```bash
meshagent chatbot join --room myroom --agent-name supabase-agent --require-toolkit supabase --web-search --rule "You are an agent who helps users work with Supabase. If the web search tool is enabled, you can search the web to learn more about the latest updates to supabase and use the supabase toolkit to interact with a specific supabase project."
```

5. Try the agent and toolkit in MeshAgent Studio
Go to [MeshAgent Studio](https://studio.meshagent.com) enter `myroom` and select the **supabase-agent** from the participants list, you'll be able to ask the agent to perform tasks that require the supabase toolkit. You can also select the + button then Web Search to turn on the web search tool. 

Now that you've tried it in MeshAgent Studio you can deploy the supabase toolkit and accompanying agent.

## Step 3: Deploy the Supabase MCP Server as a service
Create a ServiceTemplate configuration file, `meshagent.yaml` that defines how we should run the service. 

<CodeGroup>
  <MCPSupabaseYAML />
</CodeGroup>

Deploy the service template:

```bash
meshagent service create-template \
  --file "meshagent.yaml" \
  --value supabase_project_ref=$SUPABASE_PROJECT_REF \
  --room myroom
```

> Powerboards note: the ServiceTemplate includes a `supabase_access_token` variable with `meshagent.secret.*` annotations. Powerboards uses that to prompt for the token and store the room secret automatically. The CLI ignores those annotations, so you still need to set the room secret yourself when deploying from the command line.

> Warning: This command will deploy the service, but if the room secret does not exist the container will exit with `Secret 'supabase' not found` and the toolkit will not register.
